# LLM-DA 运行结果说明

## 📥 **输入数据**

### 1. 原始数据集
- **位置**: `datasets/icews14_tiny/`
- **内容**: 
  - `train.txt` - 50条训练数据
  - `valid.txt` - 10条验证数据  
  - `test.txt` - 10条测试数据
  - `entities.txt` - 7,128个实体
  - `relations.txt` - 230个关系
  - 各种映射文件 (entity2id.json, relation2id.json, ts2id.json)

### 2. 数据格式
```
实体1 \t 关系 \t 实体2 \t 时间戳
Police_(Australia) \t Arrest,_detain,_or_charge_with_legal_action \t Women_(Australia) \t 2014-01-01
```

## 📤 **输出结果**

### 1. 规则采样结果
- **位置**: `sampled_path/icews14_tiny/`
- **文件**: 
  - `rules_name.json` - 规则名称映射
  - `rules_id.json` - 规则ID映射
  - `confidence.json` - 规则置信度

### 2. LLM生成的规则
- **位置**: `gen_rules_iteration/icews14_tiny/gpt-4o-mini-top-0-f-2-l-1/`
- **文件**: 每个关系对应两个文件
  - `关系名.txt` - 生成的时序逻辑规则
  - `关系名.query` - 发送给LLM的提示词

### 3. 规则示例
**Make_statement.txt** 内容：
```
Sample 1 time:
1. Make_statement(X0,X1,T1) <- inv_Engage_in_diplomatic_cooperation(X0,X1,T0)
2. Make_statement(X0,X2,T2) <- inv_Criticize_or_denounce(X0,X1,T0) & Make_statement(X1,X2,T1)
```

### 4. 清理后的规则
- **位置**: `gen_rules_iteration/icews14_tiny/clean/rules/`
- **文件**: `关系名_summarized_rules.txt`

## 📊 **如何看效果**

### 1. 查看生成的规则
```bash
# 查看某个关系生成的规则
cat gen_rules_iteration/icews14_tiny/gpt-4o-mini-top-0-f-2-l-1/Make_statement.txt

# 查看所有生成规则的文件
ls gen_rules_iteration/icews14_tiny/gpt-4o-mini-top-0-f-2-l-1/*.txt
```

### 2. 查看规则质量
```bash
# 统计生成了多少规则
find gen_rules_iteration/icews14_tiny/gpt-4o-mini-top-0-f-2-l-1/ -name "*.txt" -exec wc -l {} \;

# 查看规则内容
head -10 gen_rules_iteration/icews14_tiny/gpt-4o-mini-top-0-f-2-l-1/Make_statement.txt
```

### 3. 运行完整评估
```bash
# 运行推理测试
python3 reasoning.py -p copy_gpt-4o-mini-top-0-f-2-l-1 -d icews14_tiny

# 运行最终评估
python3 evaluate.py -d icews14_tiny -c 'llm_test_apply_all_conf_cands_r[1,2,3]_w0_score_12[0.1,0.5,\'TLogic\',0.0,0.01,0]_top_20_et_origin.json' --graph_reasoning_type TiRGN --rule_weight 0.9
```

## 🎯 **评估指标**

### 1. 规则质量指标
- **规则数量**: 每个关系生成了多少条规则
- **规则长度**: 规则的长度（1-hop, 2-hop等）
- **规则覆盖**: 覆盖了多少种关系

### 2. 推理效果指标
- **Hit@1**: 排名第1的准确率
- **Hit@10**: 排名前10的准确率
- **MRR**: 平均倒数排名
- **MR**: 平均排名

## 📈 **当前状态**

✅ **已完成**:
- 数据加载和预处理
- LLM规则生成 (460个关系)
- 规则文件保存

⚠️ **需要完成**:
- 规则排序和筛选
- 推理测试
- 最终评估

## 💡 **下一步**

1. 运行规则排序: `python3 rank_rule.py`
2. 运行推理测试: `python3 reasoning.py`  
3. 运行最终评估: `python3 evaluate.py`
4. 查看评估结果和指标


# 1. 规则排名
python3 rank_rule.py -p gpt-4o-mini-top-0-f-2-l-1 -d icews14_tiny

# 2. 候选推理  
python3 reasoning.py -d icews14_tiny -r confidence.json -l 1 2 3 -p 8 --min_conf 0.01 --weight_0 0.5 --top_k 20

# 3. 最终评估
python3 evaluate.py -d icews14_tiny -c 'llm_test_apply_all_conf_cands_r[1,2,3]_w0_score_12[0.1,0.5,'\''TLogic'\'',0.0,0.01,0]_top_20_et_origin.json' --graph_reasoning_type TiRGN --rule_weight 0.9